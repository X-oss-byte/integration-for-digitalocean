{
    "variables": {
      "token": "{{env `DIGITALOCEAN_TOKEN`}}",
      "image_name": "appwrite-0.7.2-snapshot-{{timestamp}}"
    },
    "builders": [
      {
        "type": "digitalocean",
        "api_token": "{{user `token`}}",
        "image": "ubuntu-18-04-x64",
        "region": "nyc3",
        "size": "s-1vcpu-2gb",
        "ssh_username": "root",
        "snapshot_name": "{{user `image_name`}}"
      }
    ],
    "provisioners": [
      {
        "type": "shell",
        "inline": [
          "cloud-init status --wait"
        ]
      },
      {
        "type": "file",
        "source": "files/etc/",
        "destination": "/etc/"
      },
      {
        "type": "file",
        "source": "files/opt/",
        "destination": "/opt/"
      },
      {
        "type": "shell",
        "inline": [
          "apt -qqy update",
          "apt -qqy -o Dpkg::Options::='--force-confdef' -o Dpkg::Options::='--force-confold' full-upgrade"
        ]
      },
      {
        "type": "shell",
        "scripts": [
          "scripts/01-setup-appwrite-scripts.sh",
          "scripts/02-docker-install.sh",
          "scripts/03-docker-test.sh",
          "scripts/90-cleanup.sh",
          "scripts/99-image_check.sh"
        ]
      }
    ]
  }